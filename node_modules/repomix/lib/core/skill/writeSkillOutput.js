var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import fs from 'node:fs/promises';
import path from 'node:path';
import { RepomixError } from '../../shared/errorHandle.js';
/**
 * Writes skill output to the filesystem.
 * Creates the directory structure:
 *   <skillDir>/
 *   ├── SKILL.md
 *   └── references/
 *       ├── summary.md
 *       ├── project-structure.md
 *       ├── files.md
 *       └── tech-stack.md (if available)
 */
export const writeSkillOutput = (output_1, skillDir_1, ...args_1) => __awaiter(void 0, [output_1, skillDir_1, ...args_1], void 0, function* (output, skillDir, deps = {
    mkdir: fs.mkdir,
    writeFile: fs.writeFile,
}) {
    const referencesDir = path.join(skillDir, 'references');
    try {
        // Create directories
        yield deps.mkdir(referencesDir, { recursive: true });
        // Write SKILL.md
        const skillMdPath = path.join(skillDir, 'SKILL.md');
        yield deps.writeFile(skillMdPath, output.skillMd, 'utf-8');
        // Write reference files
        yield deps.writeFile(path.join(referencesDir, 'summary.md'), output.references.summary, 'utf-8');
        yield deps.writeFile(path.join(referencesDir, 'project-structure.md'), output.references.structure, 'utf-8');
        yield deps.writeFile(path.join(referencesDir, 'files.md'), output.references.files, 'utf-8');
        // Write tech-stack.md if available
        if (output.references.techStack) {
            yield deps.writeFile(path.join(referencesDir, 'tech-stack.md'), output.references.techStack, 'utf-8');
        }
        return skillDir;
    }
    catch (error) {
        const nodeError = error;
        if (nodeError.code === 'EPERM' || nodeError.code === 'EACCES') {
            throw new RepomixError(`Failed to write skill output to ${skillDir}: Permission denied. Please check directory permissions.`, { cause: error instanceof Error ? error : undefined });
        }
        throw new RepomixError(`Failed to write skill output: ${error instanceof Error ? error.message : String(error)}`, {
            cause: error instanceof Error ? error : undefined,
        });
    }
});
//# sourceMappingURL=writeSkillOutput.js.map